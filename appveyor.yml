version: 0.1.0
init:
  - ps: |
      if ($env:APPVEYOR_REPO_TAG -eq "false")
      {
        Update-AppveyorBuild -Version "$env:APPVEYOR_BUILD_VERSION-ci.$env:APPVEYOR_BUILD_NUMBER+sha.$($env:APPVEYOR_REPO_COMMIT.Substring(0, 9))"
      }
skip_branch_with_pr: true
image: Visual Studio 2017
dotnet_csproj:
  patch: true
  file: '**\*.csproj'
  version: '{version}'
  package_version: '{version}'
install:
  - nuget restore
  - choco install codecov
nuget:
  account_feed: true
  project_feed: true
  disable_publish_on_pr: true
configuration: Release
build:
  parallel: true
  publish_nuget: true
  publish_nuget_symbols: true
  include_nuget_references: true
  verbosity: normal
test_script:
  - dotnet test tests/GalaScriptTests/GalaScriptTests.csproj /p:CollectCoverage=true /p:CoverletOutputFormat=opencover /p:CoverletOutput=../../coverage.xml --logger:Appveyor
after_test:
  - codecov -f "coverage.xml"
deploy:
  - provider: NuGet
    name: MyGet
    server: https://www.myget.org/F/galaengine/api/v2/package
    symbol_server: https://www.myget.org/F/galaengine/symbols/api/v2/package
    api_key:
      secure: 9EKvm3W60xQMcta7WZW0BISOOISgd1535xd3ie/D/uLcuFAjzDLBRzn2myEcd5xC
    on:
      branch: master
  - provider: NuGet
    name: NuGet
    api_key:
      secure: oYRL+tdfczOc3hZH5CxipwwtvIXl+68XI375/ZBbty6/MvaGdikD1oeC9wkYwkn9
    on:
      APPVEYOR_REPO_TAG: true
  - provider: GitHub
    name: GitHub Release
    auth_token:
      secure: IApJWoucWEA6qjZn1atyOtaEMbBJVMcs8r4AeTwX3yOPWYK76w6VzOpzG+eTainp
    artifact: /.*\.nupkg/
    draft: false
    prerelease: false
    force_update: true
    on:
      APPVEYOR_REPO_TAG: true
